{% extends 'restaurant/base.html' %}
{% load static %}

{% block title %}Demand Forecasting - ARIMA{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/forecast_dashboard.css' %}">

<div class="forecast-container">
    <!-- Header -->
    <div class="forecast-header">
        <h1><i class="fas fa-chart-line"></i> Demand Forecasting</h1>
        <p style="color: #6c757d; margin: 0;">ğŸ“Š Predict how many orders you'll get in the future! Plan your staff and food inventory.</p>
    </div>
    
    <!-- Info Box -->
    <div style="background: #e7f3ff; border-left: 4px solid #17a2b8; padding: 1rem; border-radius: 6px; margin-bottom: 2rem;">
        <p style="margin: 0; color: #004085; font-size: 0.95rem;">
            <strong>ğŸ’¡ How to Use:</strong> 
            1ï¸âƒ£ Choose what to forecast (money or orders)
            2ï¸âƒ£ Pick your settings
            3ï¸âƒ£ Click "Generate Forecast"
            4ï¸âƒ£ Read the chart and numbers
            5ï¸âƒ£ Use results to plan staff and inventory!
        </p>
    </div>
    
    <!-- Messages -->
    <div class="success-message" id="successMessage"></div>
    <div class="error-message" id="errorMessage"></div>
    
    <!-- Controls Section -->
    <div class="controls-section">
        <h2 style="margin: 0 0 1rem 0; font-size: 1.1rem; font-weight: 700;">âš™ï¸ What Do You Want to Forecast?</h2>
        
        <div class="controls-grid">
            <div class="control-group">
                <label for="metricSelect">ğŸ’° What to Track?</label>
                <select id="metricSelect">
                    <option value="total_amount">Total Money (Rs.)</option>
                    <option value="count">Number of Orders</option>
                    <option value="average_amount">Average Order Price</option>
                </select>
                <small style="color: #6c757d; margin-top: 0.25rem;">Track money or count orders</small>
            </div>
            
            <div class="control-group">
                <label for="aggregationSelect">ğŸ“… Show Results By?</label>
                <select id="aggregationSelect">
                    <option value="daily" selected>Day by Day</option>
                    <option value="weekly">Week by Week</option>
                    <option value="monthly">Month</option>
                </select>
                <small style="color: #6c757d; margin-top: 0.25rem;">For staffing, use Daily</small>
            </div>
            
            <div class="control-group">
                <label for="orderTypeSelect">ğŸ›ï¸ Which Order Type?</label>
                <select id="orderTypeSelect">
                    <option value="">All Orders (Combined)</option>
                    <option value="delivery">ğŸšš Delivery Only</option>
                    <option value="takeaway">ğŸ“¦ Takeaway Only</option>
                    <option value="dine_in">ğŸ½ï¸ Dine-in Only</option>
                </select>
                <small style="color: #6c757d; margin-top: 0.25rem;">Start with "All Orders"</small>
            </div>
            
            <div class="control-group">
                <label for="periodsInput">ğŸ“Š Days Ahead to Predict?</label>
                <input type="number" id="periodsInput" value="30" min="7" max="365">
                <small style="color: #6c757d; margin-top: 0.25rem;">7=1 week, 30=1 month</small>
            </div>
            
            <div class="control-group">
                <label for="daysBackInput">ğŸ“ˆ Use How Much History?</label>
                <input type="number" id="daysBackInput" value="90" min="14" max="365">
                <small style="color: #6c757d; margin-top: 0.25rem;">90 days = 3 months (best)</small>
            </div>
            
            <div class="control-group">
                <label for="autoArimaCheckbox">
                    <input type="checkbox" id="autoArimaCheckbox" checked> âœ¨ Auto-Tune Model
                </label>
                <small style="color: #6c757d; margin-top: 0.25rem;">Keep checked for best results</small>
            </div>
        </div>
        
        <div class="btn-group">
            <button class="btn btn-primary" onclick="generateSingleForecast()">
                <i class="fas fa-play"></i> Generate Forecast
            </button>
            <button class="btn btn-secondary" onclick="generateMultiForecast()">
                <i class="fas fa-stream"></i> Compare All Types
            </button>
        </div>
    </div>
    
    <!-- Loading -->
    <div class="loading-spinner" id="loadingSpinner">
        <div class="spinner"></div>
        <p style="margin-top: 1rem; color: #6c757d;">Generating forecast...</p>
    </div>
    
    <!-- Results Section -->
    <div class="results-section" id="resultsSection" style="display: none;">
        <!-- Forecast Chart -->
        <div class="result-card">
            <h3>ğŸ“ˆ Your Forecast Chart</h3>
            <p style="color: #6c757d; font-size: 0.85rem; margin: 0 0 1rem 0;">
                Blue line = Your past sales | Red line = Prediction for future | Gray area = Range (best to worst case)
            </p>
            <div class="chart-container">
                <canvas id="forecastChart"></canvas>
            </div>
        </div>
        
        <!-- Statistics -->
        <div class="result-card">
            <h3>ğŸ“Š What The Numbers Say</h3>
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-label">Average Per Day</div>
                    <div class="stat-value" id="statMean">-</div>
                    <small style="color: #6c757d;">Expected daily value</small>
                </div>
                <div class="stat-item">
                    <div class="stat-label">How Stable?</div>
                    <div class="stat-value" id="statStd">-</div>
                    <small style="color: #6c757d;">Low = predictable</small>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Worst Day</div>
                    <div class="stat-value" id="statMin">-</div>
                    <small style="color: #6c757d;">Lowest value</small>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Best Day</div>
                    <div class="stat-value" id="statMax">-</div>
                    <small style="color: #6c757d;">Highest value</small>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Total for Period</div>
                    <div class="stat-value" id="statSum">-</div>
                    <small style="color: #6c757d;">Complete total</small>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Direction</div>
                    <div class="stat-value" id="statTrend">-</div>
                    <small style="color: #6c757d;">Going up or down?</small>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Diagnostics Section -->
    <div class="diagnostics-section" id="diagnosticsSection" style="display: none;">
        <h3 style="margin: 0 0 1rem 0;">âœ… How Good is This Forecast?</h3>
        <p style="color: #6c757d; margin: 0 0 1rem 0; font-size: 0.9rem;">
            These numbers show if the prediction is trustworthy. Higher values are usually better (except for the last one).
        </p>
        <table class="diagnostic-table">
            <thead>
                <tr>
                    <th>What It Means</th>
                    <th>Your Result</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Model Quality (lower = better) ğŸ“Š</td>
                    <td id="diagAIC">-</td>
                </tr>
                <tr>
                    <td>Alternative Quality Score (lower = better) ğŸ“Š</td>
                    <td id="diagBIC">-</td>
                </tr>
                <tr>
                    <td>How Well It Fits ğŸ“ˆ</td>
                    <td id="diagLoglik">-</td>
                </tr>
                <tr>
                    <td>Prediction Errors (should be close to 0) ğŸ¯</td>
                    <td id="diagResMean">-</td>
                </tr>
                <tr>
                    <td>How Much Variation in Errors ğŸ“Š</td>
                    <td id="diagResStd">-</td>
                </tr>
                <tr>
                    <td>Days of Data Used ğŸ“…</td>
                    <td id="diagDataPoints">-</td>
                </tr>
            </tbody>
        </table>
        <p style="color: #6c757d; margin: 1rem 0 0 0; font-size: 0.85rem;">
            ğŸ’¡ <strong>Simple Rule:</strong> If these numbers are stable and predictable, your forecast is good!
        </p>
    </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>

<script src="{% static 'js/forecast_dashboard.js' %}"></script>
{% endblock %}
